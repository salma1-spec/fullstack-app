#  Version de la syntaxe Docker Compose
version: '3.8'

# Ddes services Docker (conteneurs)
services:
  db:
    image: postgres:15           #  Utilise l‚Äôimage officielle de PostgreSQL version 15
    environment:
      POSTGRES_DB: mydb          #  Nom de la base cr√©√©e automatiquement
      POSTGRES_USER: postgres    #  Utilisateur de la base
      POSTGRES_PASSWORD: postgres # Mot de passe
    volumes:
      - pgdata:/var/lib/postgresql/data  # Volume pour sauvegarder les donn√©es (m√™me apr√®s red√©marrage)
    ports:
      - "5432:5432"              # Le port PostgreSQL (5432) est expos√© pour acc√©der √† la base si besoin

  backend:
    build:
      context: ./backend         #  Dossier o√π se trouve le Dockerfile de Spring Boot
    ports:
      - "8080:8080"              #  Expose le port 8080 ‚Üí accessible via http://localhost:8080
    depends_on:
      - db                      #  Le backend d√©marre apr√®s que PostgreSQL est pr√™t
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://db:5432/mydb      # üîó URL JDBC pour se connecter √† la base
      SPRING_DATASOURCE_USERNAME: postgres                       # üë§ identifiant
      SPRING_DATASOURCE_PASSWORD: postgres                       # üîê mot de passe

  
  frontend:
    build:
      context: ./frontend        #  Dossier o√π se trouve le Dockerfile de Angular
    ports:
      - "4200:80"                #  Angular sera accessible sur localhost:4200 (80 = port Nginx)
    depends_on:
      - backend                  #  Angular d√©marre apr√®s le backend

#  Volume persistant pour PostgreSQL
volumes:
  pgdata:
